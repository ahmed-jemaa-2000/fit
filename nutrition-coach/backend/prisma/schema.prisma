// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model
model User {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String
  name         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  
  profile        UserProfile?
  meals          Meal[]
  foodItems      FoodItem[]
  groceryItems   GroceryItem[]
  chatMessages   ChatMessage[]
  dailyNutrition DailyNutrition[]

  @@map("users")
}

// User profile and goals
model UserProfile {
  id                  String   @id @default(uuid())
  userId              String   @unique
  age                 Int
  gender              Gender
  weightKg            Float
  heightCm            Float
  activityLevel       ActivityLevel
  goal                FitnessGoal
  targetCalories      Int
  targetProteinG      Int
  targetCarbsG        Int
  targetFatG          Int
  dietaryRestrictions String[]
  allergies           String[]
  likedFoods          String[]
  dislikedFoods       String[]
  dailyBudget         Float?
  cookingPreference   CookingDifficulty?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

// Grocery items with pricing
model GroceryItem {
  id              String            @id @default(uuid())
  userId          String
  name            String

  // Category for better organization
  category        GroceryCategory
  subcategory     GrocerySubcategory?

  // Package info (how you buy it)
  packagePrice    Float    // e.g., 8.00 euros
  packageSize     Float    // e.g., 1000
  packageUnit     String   // g, kg, ml, l, pieces

  // Cooking difficulty
  difficulty      CookingDifficulty

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, name])
  @@index([userId, category])
  @@map("grocery_items")
}

// Meal tracking
model Meal {
  id          String   @id @default(uuid())
  userId      String
  name        String
  description String?
  mealType    MealType
  consumedAt  DateTime
  calories    Int
  proteinG    Float
  carbsG      Float
  fatG        Float
  fiberG      Float?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, consumedAt])
  @@map("meals")
}

// Food items library
model FoodItem {
  id          String   @id @default(uuid())
  userId      String?
  name        String
  servingSize String
  calories    Int
  proteinG    Float
  carbsG      Float
  fatG        Float
  fiberG      Float?
  isPublic    Boolean  @default(false)
  usageCount  Int      @default(0)
  createdAt   DateTime @default(now())
  
  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([name, isPublic])
  @@map("food_items")
}

// AI chat history
model ChatMessage {
  id        String   @id @default(uuid())
  userId    String
  role      MessageRole
  content   String   @db.Text
  metadata  Json?
  createdAt DateTime @default(now())
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@map("chat_messages")
}

// Daily nutrition aggregates
model DailyNutrition {
  id            String   @id @default(uuid())
  userId        String
  date          DateTime @db.Date
  totalCalories Int
  totalProteinG Float
  totalCarbsG   Float
  totalFatG     Float
  mealsCount    Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId, date])
  @@map("daily_nutrition")
}

// Enums
enum Gender {
  MALE
  FEMALE
  OTHER
}

enum ActivityLevel {
  SEDENTARY
  LIGHT
  MODERATE
  ACTIVE
  VERY_ACTIVE
}

enum FitnessGoal {
  LOSE_WEIGHT
  MAINTAIN
  GAIN_WEIGHT
  BUILD_MUSCLE
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
}

enum MessageRole {
  USER
  ASSISTANT
}

enum CookingDifficulty {
  NO_COOKING
  VERY_EASY
  EASY
  MEDIUM
  COMPLEX
}

// Grocery categories - Main food groups
enum GroceryCategory {
  PROTEINS
  CARBS
  DAIRY
  VEGETABLES
  FRUITS
  LEGUMES_CANNED
  OILS_SAUCES
  NUTS_SEEDS
  SPICES
  DRINKS
  BAKING
  SNACKS
  READY_MEALS
  SPECIALTY
}

// Grocery subcategories - Detailed classification
enum GrocerySubcategory {
  // Protein subcategories
  PROTEIN_POULTRY
  PROTEIN_BEEF_PORK
  PROTEIN_FISH
  PROTEIN_EGGS
  PROTEIN_DELI
  PROTEIN_PLANT_BASED

  // Carb subcategories
  CARB_GRAINS
  CARB_PASTA
  CARB_BREAD
  CARB_BREAKFAST
  CARB_POTATOES

  // Dairy subcategories
  DAIRY_MILK
  DAIRY_YOGURT
  DAIRY_CHEESE
  DAIRY_OTHER

  // Vegetable subcategories
  VEG_FRESH
  VEG_FROZEN

  // Fruit subcategories
  FRUIT_FRESH
  FRUIT_FROZEN
  FRUIT_DRIED

  // Legumes & Canned subcategories
  LEGUME_DRY
  LEGUME_CANNED
  LEGUME_OTHER

  // Oils & Sauces subcategories
  OIL_COOKING
  OIL_CONDIMENTS
  OIL_SAUCES
  OIL_VINEGARS
  OIL_SPREADS

  // Nuts & Seeds subcategories
  NUT_RAW
  NUT_ROASTED
  SEED
  NUT_BUTTER

  // Spices subcategories
  SPICE_HERB
  SPICE_SPICE
  SPICE_SALT_PEPPER
  SPICE_BLEND

  // Drinks subcategories
  DRINK_JUICE
  DRINK_WATER
  DRINK_TEA_COFFEE
  DRINK_OTHER

  // Baking subcategories
  BAKING_FLOUR
  BAKING_SWEETENER
  BAKING_LEAVENING
  BAKING_OTHER

  // Snacks subcategories
  SNACK_CHOCOLATE
  SNACK_CHIPS
  SNACK_FRUIT
  SNACK_MIX
  SNACK_BARS

  // Ready Meals subcategories
  READY_FROZEN
  READY_INSTANT
  READY_CANNED

  // Specialty subcategories
  SPECIALTY_GLUTEN_FREE
  SPECIALTY_VEGAN
  SPECIALTY_ORGANIC
  SPECIALTY_PROTEIN
  SPECIALTY_LOW_FAT
}
